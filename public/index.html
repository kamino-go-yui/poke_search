<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeSearch</title>
</head>

<body>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="favorite.html">Favorite</a></li>
        </ul>
    </nav>
    <input id="input" type="text">
        <button onclick="fetchFavoriteList()">Search</button>
          
    <ol id="pokeitem"></ol>
    <script>
        const fetchFavoriteList = async () => {
            // const next = await fetch('/api/pokemons');
            // await next.json();
        }
        const baseUrl = `https:pokeapi.co/api/v2/pokemon/`;
        const addFavorite = async (id) => {
            const res = await fetch(`/api/pokemons`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    id: id
                })
            });
            await res.json();
        }
        let count = 15;
        let promises = [];
        async function fetchPokemon() {
            for (let i = 1; i <= count; i++) {
                const url = baseUrl + i;
                promises.push(fetch(url).then((res) => res.json()));
            }

            Promise.all(promises).then(results => {
                const pokemon = results.map((data) => ({
                    name: data.name,
                    id: data.id,
                    image: data.sprites['front_default'],
                    type: data.types.map((type) => type.type.name).join(', ')
                }));
                displayPokemon(pokemon);
            });
            const displayPokemon = (pokemon) => {
                pokemon.map((pokemon) => {
                    const li = document.createElement('li');
                    li.innerHTML = pokemon.name;
                    const img = document.createElement('img');
                    img.src = pokemon.image;
                    li.appendChild(img);
                    const favoriteButton = document.createElement('button');
                    favoriteButton.innerText = 'Favorite!'
                    favoriteButton.addEventListener('click', () => addFavorite(pokemon.id));
                    li.appendChild(favoriteButton);
                    const ol = document.getElementById('pokeitem');
                    ol.appendChild(li, img);
                });

            }
        }
        fetchPokemon();
    </script>
</body>

</html>